<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HRIS Karyawan - YG</title>

  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0f172a" />
  <link rel="apple-touch-icon" href="./icon-192.png">

  <style>
    :root{
      --bg:#0b1220;
      --card:#0f172a;
      --muted:#94a3b8;
      --text:#e2e8f0;
      --line:#1f2937;
      --accent:#22c55e;
      --danger:#ef4444;
      --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#071023,#0b1220 40%,#0b1220);
      color:var(--text);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border:1px solid var(--line);background:rgba(15,23,42,.9);
      border-radius:16px; position:sticky; top:10px; backdrop-filter: blur(10px);
      z-index:10;
    }
    .title{
      display:flex;flex-direction:column;gap:2px;
    }
    .title h1{margin:0;font-size:18px}
    .title small{color:var(--muted)}
    .btn{
      border:1px solid var(--line);
      background:#111c33;color:var(--text);
      padding:10px 12px;border-radius:12px;
      cursor:pointer;font-weight:600;
    }
    .btn:hover{filter:brightness(1.1)}
    .btn.primary{background:linear-gradient(135deg,#16a34a,#22c55e);border:none;color:#071023}
    .btn.danger{background:linear-gradient(135deg,#dc2626,#ef4444);border:none;color:#fff}
    .btn.ghost{background:transparent}
    .grid{
      display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px;
    }
    @media(min-width:980px){
      .grid{grid-template-columns:420px 1fr}
    }
    .card{
      border:1px solid var(--line);
      background:rgba(15,23,42,.9);
      border-radius:18px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .card h2{margin:0 0 10px 0;font-size:16px}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{font-size:12px;color:var(--muted)}
    input,select{
      width:100%;
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--line);
      background:#0b1730;color:var(--text);
      outline:none;
    }
    input:focus,select:focus{border-color:#334155}
    .actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .muted{color:var(--muted)}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 10px;border-radius:999px;border:1px solid var(--line);
      background:#0b1730;color:var(--muted);font-size:12px;
    }
    .pill strong{color:var(--text)}
    table{width:100%;border-collapse:collapse}
    th,td{
      border-bottom:1px solid var(--line);
      padding:10px 8px;text-align:left;font-size:13px;
      vertical-align:top;
    }
    th{color:var(--muted);font-weight:700}
    .badge{
      display:inline-block;padding:4px 10px;border-radius:999px;
      font-size:12px;font-weight:700;
    }
    .badge.ok{background:rgba(34,197,94,.15);color:#22c55e;border:1px solid rgba(34,197,94,.35)}
    .badge.no{background:rgba(239,68,68,.15);color:#ef4444;border:1px solid rgba(239,68,68,.35)}
    .mini{
      display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px
    }
    @media(min-width:980px){
      .mini{grid-template-columns:1fr 1fr}
    }
    .kpi{
      border:1px solid var(--line);border-radius:16px;padding:12px;background:#0b1730;
    }
    .kpi .v{font-size:22px;font-weight:900}
    .kpi .k{color:var(--muted);font-size:12px}
    .chartbox{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:980px){
      .chartbox{grid-template-columns:1fr 1fr}
    }
    .chart{
      border:1px solid var(--line);border-radius:16px;padding:12px;background:#0b1730;
    }
    .chart h3{margin:0 0 10px 0;font-size:14px;color:var(--muted)}
    .barline{
      height:10px;border-radius:999px;background:#0f172a;border:1px solid var(--line);overflow:hidden;
    }
    .barfill{height:100%}
    .footnote{font-size:12px;color:var(--muted);margin-top:10px}
    .hide{display:none}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">
        <h1>HRIS Karyawan (Online) üßæ</h1>
        <small id="subtitle">Login dulu untuk akses data</small>
      </div>

      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <span class="pill" id="userPill" style="display:none;">
          üë§ <strong id="userEmail">-</strong>
        </span>
        <button class="btn ghost" id="btnInstall" style="display:none;">‚ûï Install</button>
        <button class="btn danger" id="btnLogout" style="display:none;">Logout</button>
      </div>
    </div>

    <!-- LOGIN -->
    <div class="card" id="loginCard" style="margin-top:14px;">
      <h2>Login Admin üîê</h2>
      <div class="row2">
        <div>
          <label>Email</label>
          <input id="loginEmail" type="email" placeholder="email" autocomplete="username"/>
        </div>
        <div>
          <label>Password</label>
          <input id="loginPassword" type="password" placeholder="password" autocomplete="current-password"/>
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" id="btnLogin">Login</button>
      </div>
      <div class="footnote">
        Kalau berhasil login tapi gak muncul apa-apa, biasanya cache PWA. Coba refresh / clear site data üòÑ
      </div>
    </div>

    <!-- APP -->
    <div class="grid hide" id="appGrid">

      <!-- FORM -->
      <div class="card">
        <h2>Input / Edit Karyawan ‚úçÔ∏è</h2>

        <div class="row2">
          <div>
            <label>Nama</label>
            <input id="f_name" placeholder="Nama lengkap" />
          </div>
          <div>
            <label>Nomor Karyawan</label>
            <input id="f_employee_no" placeholder="Contoh: BOL-001" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label>Tanggal Lahir</label>
            <input id="f_birth_date" type="date" />
          </div>
          <div>
            <label>Jenis Kelamin</label>
            <select id="f_gender">
              <option value="">- pilih -</option>
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div>
            <label>Unit Kerja</label>
            <select id="f_unit_work"></select>
          </div>
          <div>
            <label>Jabatan</label>
            <input id="f_position" placeholder="Contoh: Staff Produksi" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label>Tanggal Join</label>
            <input id="f_join_date" type="date" />
          </div>
          <div>
            <label>Tanggal Resign</label>
            <input id="f_resign_date" type="date" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label>No. Telepon</label>
            <input id="f_phone" placeholder="08xxxxxxxxxx" />
          </div>
          <div>
            <label>Email</label>
            <input id="f_email" type="email" placeholder="nama@domain.com" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Alamat Rumah</label>
            <input id="f_address" placeholder="Alamat lengkap" />
          </div>
        </div>

        <hr style="border:0;border-top:1px solid var(--line);margin:12px 0;">

        <div class="row2">
          <div>
            <label>Gaji Pokok</label>
            <input id="f_base_salary" type="number" step="0.01" placeholder="0" />
          </div>
          <div>
            <label>Tunjangan</label>
            <input id="f_allowance" type="number" step="0.01" placeholder="0" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label>Lembur</label>
            <input id="f_overtime" type="number" step="0.01" placeholder="0" />
          </div>
          <div>
            <label>Perjalanan Dinas</label>
            <input id="f_business_trip" type="number" step="0.01" placeholder="0" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label>Potongan</label>
            <input id="f_deduction" type="number" step="0.01" placeholder="0" />
          </div>
          <div>
            <label>Total Take Home Pay (Preview)</label>
            <input id="f_thp_preview" disabled />
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="btnSave">üíæ Simpan</button>
          <button class="btn" id="btnReset">üîÑ Reset</button>
        </div>

        <div class="footnote muted">
          Resign otomatis bikin status jadi <b>Tidak Aktif</b> (trigger Supabase).
        </div>
      </div>

      <!-- DATA -->
      <div class="card">
        <h2>Database Karyawan üìã</h2>

        <div class="row2">
          <div>
            <label>Filter Unit Kerja</label>
            <select id="filterUnit"></select>
          </div>
          <div style="display:flex;gap:8px;align-items:end;justify-content:flex-end;flex-wrap:wrap;">
            <button class="btn" id="btnReload">üîÉ Reload</button>
            <button class="btn" id="btnExport">‚¨áÔ∏è Export Excel (CSV)</button>
          </div>
        </div>

        <div class="mini">
          <div class="kpi">
            <div class="v" id="kpiTotal">0</div>
            <div class="k">Total Karyawan</div>
          </div>
          <div class="kpi">
            <div class="v" id="kpiActive">0</div>
            <div class="k">Aktif</div>
          </div>
          <div class="kpi">
            <div class="v" id="kpiInactive">0</div>
            <div class="k">Tidak Aktif</div>
          </div>
          <div class="kpi">
            <div class="v" id="kpiTurnover">0</div>
            <div class="k">Turnover (Resign)</div>
          </div>
        </div>

        <div class="chartbox" style="margin-top:12px;">
          <div class="chart">
            <h3>Perbandingan Gender</h3>
            <div class="muted" style="display:flex;justify-content:space-between;margin-bottom:6px;">
              <span>Laki-laki: <b id="maleCount">0</b></span>
              <span>Perempuan: <b id="femaleCount">0</b></span>
            </div>
            <div class="barline">
              <div class="barfill" id="genderBar" style="width:50%;background:linear-gradient(90deg,#38bdf8,#a78bfa);"></div>
            </div>
          </div>

          <div class="chart">
            <h3>Turnover (Resign)</h3>
            <div class="muted" style="margin-bottom:6px;">
              Total resign: <b id="resignCount">0</b>
            </div>
            <div class="barline">
              <div class="barfill" id="turnoverBar" style="width:0%;background:linear-gradient(90deg,#fb7185,#f59e0b);"></div>
            </div>
          </div>
        </div>

        <div style="margin-top:12px;overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>Nama</th>
                <th>No</th>
                <th>Unit</th>
                <th>Jabatan</th>
                <th>Status</th>
                <th>Join</th>
                <th>Resign</th>
                <th>THP</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="footnote">
          Tips: Klik <b>Edit</b> untuk ubah data. Klik <b>Hapus</b> kalau mau bersihin data dummy üòÑ
        </div>
      </div>

    </div>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./app.js"></script>

  <script>
    // PWA install
    let deferredPrompt = null;
    const btnInstall = document.getElementById("btnInstall");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      btnInstall.style.display = "inline-flex";
    });

    btnInstall.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      deferredPrompt = null;
      btnInstall.style.display = "none";
    });

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    }
  </script>
</body>
</html>